<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Caddie Roulette</title>
    
    <link rel="manifest" href="./manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FFFFFF">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary: #064E3B; 
            --primary-light: #059669; 
            --accent: #FACC15; 
            --text-main: #1F2937;
            --font-display: "Impact", "Arial Black", sans-serif;
            --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: #FFFFFF; 
            color: var(--text-main); 
            font-family: var(--font-sans); 
            height: 100dvh; 
            overflow: hidden; 
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        /* APP CONTAINER */
        .app-container { 
            width: 100%;
            height: 100dvh; 
            display: flex; 
            flex-direction: column; 
            background: #FFFFFF; 
            position: relative;
            box-shadow: none !important;
            border: none !important;
        }

        @media (min-width: 500px) {
            .app-container { max-width: 450px; margin: 0 auto; }
        }

        /* HEADER */
        .header { 
            height: 100px;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0;
            position: relative;
            z-index: 20;
            width: 100%;
            background: #FFFFFF;
        }
        .header-logo { height: 75px; width: 75px; }
        
        .header-right { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); }
        .header-btn { background: transparent; border: none; cursor: pointer; color: #9CA3AF; padding: 8px; }

        /* ROOM CODE STYLES */
        .room-info-container {
            position: absolute; 
            left: 20px; 
            top: 50%; 
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
        }
        .room-label {
            font-size: 10px;
            font-weight: 800;
            color: #9CA3AF;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }
        .room-code { 
            font-family: var(--font-display); 
            font-size: 20px; 
            color: #6B7280; 
            letter-spacing: 1px; 
            line-height: 1;
        }

        /* LAYOUT */
        .game-content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            width: 100%; 
            height: 100%;
            overflow: hidden;
        }

        .top-section {
            height: 52%; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            width: 100%;
            position: relative;
            overflow: visible; 
        }

        .bottom-section {
            height: 48%; 
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
            padding: 0 15px; 
            background: #FFFFFF;
        }

        /* WHEEL COMPONENT */
        .wheel-stage {
            position: relative; width: 280px; height: 280px; border-radius: 50%;
            background: #111827; 
            overflow: hidden; display: flex; align-items: center; justify-content: center;
            border: 4px solid #111827; 
        }
        
        .wheel-rim { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 12px solid #281D11; pointer-events: none; z-index: 20; }
        
        .wheel-spinner {
            width: 95%; height: 95%; border-radius: 50%; position: relative;
            transition: transform 3.5s cubic-bezier(0.2, 0.8, 0.1, 1); 
            transform: rotate(0deg);
        }
        .wheel-spinner.spinning { animation: spinCW 0.6s linear infinite; }
        @keyframes spinCW { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* NUMBERS - Radiating outward to fit all 38 beautifully */
        .wheel-number {
            position: absolute; top: 50%; left: 50%;
            font-family: var(--font-display); color: white; font-size: 10px; 
            width: 14px; height: 14px; line-height: 14px; text-align: center;
            margin-top: -7px; margin-left: -7px; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.9);
            z-index: 10;
        }

        /* BALL PHYSICS */
        .ball-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; 
            z-index: 50; 
            transition: transform 3.5s cubic-bezier(0.2, 0.8, 0.1, 1);
        }
        .ball-container.spinning { animation: spinCCW 1.2s linear infinite; }
        @keyframes spinCCW { 0% { transform: rotate(0deg); } 100% { transform: rotate(-360deg); } }

        .ball-container.spinning .ball { animation: bounce 0.3s ease-in-out infinite alternate; }
        @keyframes bounce { from { top: 22px; } to { top: 18px; } }

        .ball { 
            position: absolute; top: 20px; left: 50%; margin-left: -6px; 
            width: 12px; height: 12px; 
            background: white; border-radius: 50%; 
            box-shadow: 0 0 4px rgba(0,0,0,0.5); 
        }

        .wheel-center {
            position: absolute; width: 100px; height: 100px; background: #111827; border: 4px solid #FACC15;
            border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 30;
        }
        .result-number-center { font-size: 38px; font-weight: 900; color: white; line-height: 1; }
        .result-label-center { font-size: 10px; color: #FACC15; font-weight: 700; letter-spacing: 1px; margin-top: 4px; text-align: center; padding: 0 4px;}

        /* UI ELEMENTS */
        .btn { 
            border: none; padding: 18px 0; border-radius: 16px; 
            font-weight: 800; font-size: 16px; width: 100%; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; 
            text-transform: uppercase; letter-spacing: 2px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-accent { background: var(--accent); color: #422006; }

        /* --- AUTHENTIC ROULETTE BETTING BOARD --- */
        .betting-board-container { width: 100%; margin-bottom: 15px; display: flex; flex-direction: column; align-items: center; }
        .betting-board-label { font-size: 10px; font-weight: 800; color: #9CA3AF; letter-spacing: 1px; margin-bottom: 6px; text-transform: uppercase; }
        .betting-board { display: flex; width: 100%; max-width: 400px; gap: 2px; background: #111827; padding: 4px; border-radius: 6px; }
        .board-col-zeroes { display: flex; flex-direction: column; width: 8%; gap: 2px; }
        .board-grid-main { display: flex; flex-direction: column; width: 92%; gap: 2px; }
        .board-row { display: flex; flex: 1; gap: 2px; }
        
        .board-btn { 
            flex: 1; border: none; color: white; font-family: var(--font-display); 
            font-size: 11px; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; position: relative; border-radius: 2px; min-height: 24px;
        }
        .board-btn.selected { box-shadow: inset 0 0 0 2px #FACC15; z-index: 5; }
        
        .golf-ball-chip { 
            position: absolute; width: 14px; height: 14px; background: #FFFFFF; border-radius: 50%; 
            box-shadow: inset -2px -2px 3px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.4); 
            background-image: radial-gradient(circle, #E5E7EB 10%, transparent 10%), radial-gradient(circle, #E5E7EB 10%, transparent 10%); 
            background-size: 3px 3px; background-position: 0 0, 1.5px 1.5px; 
            z-index: 10;
        }

        /* ZONE SELECTOR - RESTORED TO CLEAN GRID */
        .zone-selector { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center;
            gap: 6px; 
            margin-bottom: 15px; 
            background: transparent; 
            width: 100%; 
            max-height: 120px;
            overflow-y: auto;
        }
        .zone-btn { 
            flex: 1 1 calc(33% - 12px); 
            min-width: 80px; 
            padding: 10px 4px; 
            border-radius: 10px; 
            border: none; 
            background: #F3F4F6; 
            color: #9CA3AF; 
            font-weight: 800; 
            font-size: 10px; 
            cursor: pointer; 
            letter-spacing: 0.5px; 
            transition: 0.2s;
        }
        .zone-btn.active { 
            background: var(--primary); 
            color: white; 
            box-shadow: 0 4px 12px rgba(6, 78, 59, 0.3); 
        }

        /* CHALLENGE CARD STYLES */
        .result-container { 
            width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        @keyframes popIn { from { transform: translateY(20px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        
        .result-card {
            background: #FFFFFF;
            border: 4px solid #111827;
            border-radius: 24px;
            padding: 35px 20px 25px 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 4px 8px 0px rgba(17, 24, 39, 1);
        }
        
        .result-zone-badge {
            position: absolute;
            top: -18px;
            background: var(--accent);
            color: #111827;
            padding: 6px 20px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            border: 4px solid #111827;
        }

        .result-number-pill {
            background: #DC2626;
            color: white;
            padding: 6px 16px;
            border-radius: 12px;
            font-family: var(--font-display);
            font-size: 20px;
            border: 3px solid #111827;
            margin-bottom: 16px;
        }

        .result-text { 
            font-family: var(--font-display); font-size: 28px; color: #1F2937; 
            text-transform: uppercase; text-align: center; line-height: 1.1;
            width: 100%;
        }

        .input-lg { font-size: 24px; padding: 20px; text-align: center; border: 2px solid #E5E7EB; border-radius: 16px; width: 100%; outline: none; font-weight: 800; letter-spacing: 4px; text-transform: uppercase; background: #F9FAFB; margin-bottom: 20px; }
        .input-lg:focus { border-color: var(--primary); background: white; }

        .modal-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.95); display: flex; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal-content { background: white; width: 100%; max-width: 400px; text-align: center; display: flex; flex-direction: column; max-height: 90vh; }
        
        /* SETTINGS & TABS */
        .modal-tabs { display: flex; width: 100%; border-bottom: 1px solid #F3F4F6; margin-bottom: 20px; }
        .modal-tab { flex: 1; padding: 14px; text-align: center; font-weight: 800; font-size: 12px; color: #9CA3AF; cursor: pointer; border-bottom: 2px solid transparent; letter-spacing: 1px; }
        .modal-tab.active { color: var(--primary); border-bottom-color: var(--primary); }

        .settings-content { overflow-y: auto; padding: 0 10px; width: 100%; }

        .settings-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid #F3F4F6; text-align: left; width: 100%; }
        .toggle-switch { width: 50px; height: 30px; background: #E5E7EB; border-radius: 30px; position: relative; cursor: pointer; transition: 0.2s; }
        .toggle-switch.on { background: var(--primary); }
        .toggle-circle { width: 26px; height: 26px; background: white; border-radius: 50%; position: absolute; top: 2px; left: 2px; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .toggle-switch.on .toggle-circle { left: 22px; }

        .howto-section { margin-bottom: 30px; }
        .howto-step { display: flex; align-items: flex-start; margin-bottom: 16px; text-align: left; }
        .howto-num { width: 28px; height: 28px; background: #E5E7EB; color: #374151; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 12px; margin-right: 12px; flex-shrink: 0; }
        .howto-text { font-size: 14px; color: #4B5563; line-height: 1.4; padding-top: 4px; font-weight: 500; }
        .howto-title { font-size: 12px; font-weight: 800; color: #9CA3AF; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 16px; text-align: left; display: block; }

        .rules-zone-nav { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 15px; justify-content: center; }
        .rules-zone-btn { flex: 1 1 calc(30% - 8px); min-width: 70px; padding: 8px 4px; font-size: 9px; font-weight: 800; background: #F3F4F6; border-radius: 6px; border:none; color: #9CA3AF; cursor: pointer; letter-spacing: 0.5px;}
        .rules-zone-btn.active { background: #1F2937; color: white; }

        .challenge-list { text-align: left; }
        .challenge-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #F3F4F6; font-size: 12px; color: #374151; font-weight: 600; }
        .challenge-num { width: 28px; height: 28px; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 800; margin-right: 12px; flex-shrink: 0; font-family: var(--font-display); }

    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, doc, updateDoc, onSnapshot, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        
        const firebaseConfig = {
          apiKey: "AIzaSyCw3_nIjjDYUo-lVpV7qtj6Kdn9dbPM0dE",
          authDomain: "caddieroulette-9f6b4.firebaseapp.com",
          projectId: "caddieroulette-9f6b4",
          storageBucket: "caddieroulette-9f6b4.firebasestorage.app",
          messagingSenderId: "108668982333",
          appId: "1:108668982333:web:0f5eabea5caec6ab844654"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        window.ops = { collection, addDoc, doc, updateDoc, onSnapshot, getDoc, setDoc, signInAnonymously, signOut, onAuthStateChanged };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // AUTHENTIC AMERICAN ROULETTE SEQUENCE
        const SLOTS = ["0", "28", "9", "26", "30", "11", "7", "20", "32", "17", "5", "22", "34", "15", "3", "24", "36", "13", "1", "00", "27", "10", "25", "29", "12", "8", "19", "31", "18", "6", "21", "33", "16", "4", "23", "35", "14", "2"];
        const ORDERED_KEYS = ["0", "00"].concat(Array.from({length: 36}, (_, i) => String(i + 1)));

        // Gets authentic red/black/green colors
        const getSlotColor = (slot) => {
            if (slot === '0' || slot === '00') return '#059669'; 
            const reds = ['1', '3', '5', '7', '9', '12', '14', '16', '18', '19', '21', '23', '25', '27', '30', '32', '34', '36'];
            return reds.includes(slot) ? '#DC2626' : '#1F2937'; 
        };

        // Generates the 38-slice pie chart background
        const getWheelGradient = () => {
            const angle = 360 / 38;
            let slices = [];
            SLOTS.forEach((slot, i) => {
                slices.push(`${getSlotColor(slot)} ${i * angle}deg ${(i + 1) * angle}deg`);
            });
            return `conic-gradient(${slices.join(', ')})`;
        };

        // 38 CHALLENGES FOR EVERY ZONE
        const CHALLENGES = {
            "PAR 3 TEE": {
                "0": "JACKPOT: Free Pass & Give 1 Drink", "00": "DISASTER: Take Penalty & Drink",
                "1": "Putter off the Tee", "2": "Opponent Picks Club", "3": "Eyes Closed Swing", "4": "Baseball Grip", "5": "Stand on One Leg", 
                "6": "Cross-Handed Grip", "7": "No Tees Allowed", "8": "3-Second Pause at Top", "9": "Yell 'FORE' at Impact", "10": "Half-Swing Only", 
                "11": "Commentate Your Shot", "12": "Must Hit a Fade", "13": "Must Hit a Draw", "14": "Drop Ball (No Tee)", "15": "7-Iron Only", 
                "16": "Swing While Talking", "17": "Opposite Handed", "18": "Speed Golf (10 sec)", "19": "Opponent Distracts You", "20": "No Practice Swings", 
                "21": "Choke Down to Shaft", "22": "Stinger Only", "23": "Dizzy Bat (3 spins)", "24": "Swing on Knees", "25": "Use a Wedge",
                "26": "Hold Finish for 5 Secs", "27": "Happy Gilmore Step", "28": "Opposite Stance", "29": "Hit it Barefoot", "30": "Hum a Song During Swing",
                "31": "Sing Your Favorite Song", "32": "One Handed Finish", "33": "No Glove Allowed", "34": "Swing 110% Effort", "35": "Swing 50% Speed", "36": "Play as Normal"
            },
            "PAR 4 TEE": {
                "0": "JACKPOT: Free Pass & Give 1 Drink", "00": "DISASTER: Take Penalty & Drink",
                "1": "Driver off the Deck", "2": "7-Iron Only", "3": "Happy Gilmore", "4": "Wrong Handed", "5": "Tee it High (Driver)", 
                "6": "No Practice Swing", "7": "Must Hit Draw", "8": "Must Hit Fade", "9": "No Glove Allowed", "10": "Eyes Closed Swing", 
                "11": "Dizzy Bat (Spin 3x)", "12": "Opposite Stance", "13": "Putter off Tee", "14": "3-Wood Only", "15": "Swing 50% Speed", 
                "16": "One Handed Finish", "17": "Baseball Grip", "18": "Yell 'Baba Booey'", "19": "Drop Ball (No Tee)", "20": "Opponent Tees It Up", 
                "21": "Stand on One Leg", "22": "3-Second Pause at Top", "23": "Cross-Handed", "24": "Commentate Your Shot", "25": "Hit it Barefoot",
                "26": "Swing While Talking", "27": "Use a Wedge", "28": "Hold Finish for 5 Secs", "29": "Opponent Distracts You", "30": "Hum a Song During Swing",
                "31": "Sing Your Favorite Song", "32": "Choke Down to Shaft", "33": "Speed Golf (10 sec)", "34": "Swing 110% Effort", "35": "Stinger Attempt", "36": "Play as Normal"
            },
            "PAR 5 TEE": {
                "0": "JACKPOT: Free Pass & Give 1 Drink", "00": "DISASTER: Take Penalty & Drink",
                "1": "Happy Gilmore", "2": "Wood/Hybrid Only", "3": "Swing 110% Effort", "4": "No Practice Swing", "5": "Commentate Your Shot", 
                "6": "Eyes Closed Impact", "7": "Wrong Handed", "8": "Tee it as Low as Possible", "9": "3-Second Pause at Top", "10": "Opponent Tees It Up", 
                "11": "Yell 'MASHED POTATOES'", "12": "One Handed Finish", "13": "Driver off the Deck", "14": "7-Iron Only", "15": "Dizzy Bat (5 spins)", 
                "16": "No Tees Allowed", "17": "Cross-Handed Grip", "18": "Baseball Grip", "19": "Opposite Stance", "20": "Swing While Talking", 
                "21": "Opponent Picks Club", "22": "Stand on One Leg", "23": "Must Hit a Fade", "24": "Must Hit a Draw", "25": "Hit it Barefoot",
                "26": "Drop Ball (No Tee)", "27": "Hold Finish for 5 Secs", "28": "Opponent Distracts You", "29": "Hum a Song During Swing", "30": "Sing Your Favorite Song",
                "31": "Choke Down to Shaft", "32": "Speed Golf (10 sec)", "33": "No Glove Allowed", "34": "Putter off the Tee", "35": "Swing 50% Speed", "36": "Play as Normal"
            },
            "FAIRWAY": {
                "0": "JACKPOT: Free Pass & Give 1 Drink", "00": "DISASTER: Take Penalty & Drink",
                "1": "Club Up 2 (Half Swing)", "2": "Putter from Fairway", "3": "Baseball Grip", "4": "Low Stinger", "5": "Stand on One Leg", 
                "6": "Opponent Picks Club", "7": "Eyes Closed Impact", "8": "3-Second Pause at Top", "9": "Cross-Handed Grip", "10": "Pick it Clean (No Divot)", 
                "11": "Wrong Handed", "12": "Play on Your Knees", "13": "Club Down 2 (Swing Hard)", "14": "No Practice Swings", "15": "Swing 50% Speed", 
                "16": "Drop Ball Again", "17": "Opposite Stance", "18": "One Handed Finish", "19": "Commentate Your Shot", "20": "Yell 'Get in the hole!'", 
                "21": "Foot Wedge (Kick 10ft)", "22": "7-Iron Only", "23": "Play with No Glove", "24": "Happy Gilmore Step", "25": "Hit it Barefoot",
                "26": "Swing While Talking", "27": "Hold Finish for 5 Secs", "28": "Opponent Distracts You", "29": "Hum a Song During Swing", "30": "Sing Your Favorite Song",
                "31": "Choke Down to Shaft", "32": "Speed Golf (10 sec)", "33": "Dizzy Bat (3 spins)", "34": "Swing 110% Effort", "35": "Use a Wood/Hybrid", "36": "Play as Normal"
            },
            "ROUGH": {
                "0": "JACKPOT: Free Pass & Give 1 Drink", "00": "DISASTER: Take Penalty & Drink",
                "1": "Use a Wood/Hybrid", "2": "Club Down 2 (Swing Hard)", "3": "Baseball Grip", "4": "Eyes Closed Swing", "5": "No Practice Swing", 
                "6": "Foot Wedge (Kick it 10ft)", "7": "Chop it out (Wedge Only)", "8": "One Handed Finish", "9": "Stand on One Leg", "10": "Opponent Picks Club", 
                "11": "Yell 'FORE' at Impact", "12": "Play from Knees", "13": "Club Up 2 (Half Swing)", "14": "Putter out of Rough", "15": "Wrong Handed", 
                "16": "Cross-Handed Grip", "17": "Stinger Attempt", "18": "Pick it Clean", "19": "Opposite Stance", "20": "Opponent Drops Ball", 
                "21": "3-Second Pause at Top", "22": "Swing 110% Effort", "23": "Commentate Shot", "24": "Dizzy Bat (3 spins)", "25": "Hit it Barefoot",
                "26": "Swing While Talking", "27": "Hold Finish for 5 Secs", "28": "Opponent Distracts You", "29": "Hum a Song During Swing", "30": "Sing Your Favorite Song",
                "31": "Choke Down to Shaft", "32": "Speed Golf (10 sec)", "33": "No Glove Allowed", "34": "Swing 50% Speed", "35": "Happy Gilmore Step", "36": "Play as Normal"
            },
            "BUNKER": {
                "0": "JACKPOT: Free Drop Outside Bunker", "00": "DISASTER: Take Penalty & Drink",
                "1": "Play with Eyes Closed", "2": "Putter out of Sand", "3": "Hit Backwards", "4": "Opponent Draws Line", "5": "One Handed Splash", 
                "6": "No Practice Swing", "7": "Use a 7-Iron", "8": "Feet Outside Bunker", "9": "Must Yell 'KOBE'", "10": "Baseball Grip", 
                "11": "Wrong Handed", "12": "Opponent Drops Ball", "13": "Use a Wood/Hybrid", "14": "Cross-Handed Grip", "15": "Swing 110% Effort", 
                "16": "Play on Knees", "17": "Stand on One Leg", "18": "3-Second Pause at Top", "19": "Opposite Stance", "20": "Commentate Shot", 
                "21": "No Raking (Play as lies)", "22": "Face Completely Closed", "23": "Foot Wedge", "24": "Use Your Hand (Toss it)", "25": "Hit it Barefoot",
                "26": "Swing While Talking", "27": "Hold Finish for 5 Secs", "28": "Opponent Distracts You", "29": "Hum a Song During Swing", "30": "Sing Your Favorite Song",
                "31": "Choke Down to Shaft", "32": "Speed Golf (10 sec)", "33": "No Glove Allowed", "34": "Swing 50% Speed", "35": "Happy Gilmore Step", "36": "Play as Normal"
            },
            "GREEN": {
                "0": "JACKPOT: Free Pass (Pick it up, it's Good)", "00": "DISASTER: Putt with Opposite End of Club",
                "1": "Putt with Wedge", "2": "Pool Cue Style", "3": "Eyes Closed Putt", "4": "Opponent Places Ball", "5": "Pin In", 
                "6": "Chip on Green", "7": "Putt Between Legs", "8": "One Handed Putt", "9": "No Read Allowed", "10": "Knee Putt", 
                "11": "Reverse Grip", "12": "Eyes Open (Normal)", "13": "Putt with Driver", "14": "Hit Backwards", "15": "Opposite Stance", 
                "16": "Opponent Reads Putt", "17": "Blow on Ball (No Club)", "18": "3-Second Pause in Stroke", "19": "Stand on One Leg", "20": "Putt from Fringe", 
                "21": "Yell 'It's in the hole!'", "22": "No Practice Putts", "23": "Cross-Handed Grip", "24": "Commentate Your Putt", "25": "Putt Barefoot",
                "26": "Talk During Putt", "27": "Hold Finish for 5 Secs", "28": "Opponent Distracts You", "29": "Hum a Song During Putt", "30": "Sing Your Favorite Song",
                "31": "Speed Golf (5 sec to putt)", "32": "Dizzy Bat (3 spins)", "33": "Look Only at the Hole", "34": "Putt with an Iron", "35": "Use Only One Eye", "36": "Play as Normal"
            }
        };

        const Modal = ({ isOpen, title, message, onClose }) => {
            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" style={{padding: 20}} onClick={e => e.stopPropagation()}>
                        <h3 style={{fontSize: 24, fontWeight: 900, marginBottom: 10, color: '#1F2937', textTransform:'uppercase'}}>{title}</h3>
                        <p style={{color: '#4B5563', marginBottom: 30, fontSize:16, lineHeight:1.5}}>{message}</p>
                        <button className="btn btn-primary" onClick={onClose}>GOT IT</button>
                    </div>
                </div>
            );
        };

        const SettingsModal = ({ isOpen, onClose, soundOn, toggleSound, onLogout }) => {
            const [tab, setTab] = useState('SETTINGS');
            const [viewZone, setViewZone] = useState('PAR 4 TEE');

            if (!isOpen) return null;
            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal-content" onClick={e => e.stopPropagation()}>
                        <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', padding:'20px 20px 0 20px'}}>
                            <h2 style={{fontFamily:'var(--font-display)', fontSize:28, color:'#1F2937'}}>MENU</h2>
                            <button onClick={onClose} style={{border:'none', background:'transparent'}}><i data-lucide="x" color="#9CA3AF" size="24"></i></button>
                        </div>

                        <div className="modal-tabs">
                            <div className={`modal-tab ${tab === 'SETTINGS' ? 'active' : ''}`} onClick={() => setTab('SETTINGS')}>SETTINGS</div>
                            <div className={`modal-tab ${tab === 'RULES' ? 'active' : ''}`} onClick={() => setTab('RULES')}>CHALLENGES</div>
                        </div>

                        <div className="settings-content">
                            {tab === 'SETTINGS' ? (
                                <>
                                    <div className="howto-section">
                                        <span className="howto-title">How To Play</span>
                                        <div className="howto-step">
                                            <div className="howto-num">1</div>
                                            <div className="howto-text">Host selects the Zone (Par 3, Fairway, Bunker, etc.) based on where your group is.</div>
                                        </div>
                                        <div className="howto-step">
                                            <div className="howto-num">2</div>
                                            <div className="howto-text">Host spins the wheel. The result syncs to everyone's phone.</div>
                                        </div>
                                        <div className="howto-step">
                                            <div className="howto-num">3</div>
                                            <div className="howto-text">Perform the challenge for that shot. If you refuse, take a penalty stroke (or a drink).</div>
                                        </div>
                                    </div>

                                    <div className="settings-row" style={{borderTop:'1px solid #F3F4F6'}}>
                                         <span style={{fontWeight:700, fontSize:16, color:'#374151'}}>Sound Effects</span>
                                         <div className={`toggle-switch ${soundOn ? 'on' : ''}`} onClick={toggleSound}>
                                             <div className="toggle-circle"></div>
                                         </div>
                                    </div>
                                    
                                    <div style={{marginTop:30, marginBottom: 20}}>
                                        <button className="btn btn-primary" style={{background:'#FEE2E2', color:'#DC2626', boxShadow:'none', fontSize: 14, padding: '16px 0'}} onClick={onLogout}>EXIT GAME</button>
                                    </div>
                                </>
                            ) : (
                                <>
                                    <div className="rules-zone-nav">
                                        {Object.keys(CHALLENGES).map(z => (
                                            <button key={z} className={`rules-zone-btn ${viewZone === z ? 'active' : ''}`} onClick={() => setViewZone(z)}>
                                                {z}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="challenge-list">
                                        {ORDERED_KEYS.map((key) => (
                                            <div className="challenge-item" key={key}>
                                                <div className="challenge-num" style={{background: getSlotColor(key)}}>{key}</div>
                                                <span>{CHALLENGES[viewZone][key]}</span>
                                            </div>
                                        ))}
                                    </div>
                                    <div style={{height: 20}}></div>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const RouletteWheel = ({ isSpinning, resultSlot, zone }) => {
            const [landingAngle, setLandingAngle] = useState(0);

            useEffect(() => {
                if (!isSpinning && resultSlot) {
                    const randomIdx = Math.floor(Math.random() * 38);
                    const anglePerSlot = 360 / 38; 
                    setLandingAngle(randomIdx * anglePerSlot);
                }
            }, [isSpinning, resultSlot]);

            const anglePerSlot = 360 / 38;
            const targetIndex = resultSlot ? SLOTS.indexOf(resultSlot) : 0;
            const targetNumberAngle = resultSlot ? (targetIndex * anglePerSlot + (anglePerSlot / 2)) : 0;
            const wheelRotation = landingAngle - targetNumberAngle;
            
            return (
                <div className="wheel-stage">
                    <div className="wheel-rim"></div>
                    
                    <div className={`wheel-spinner ${isSpinning ? 'spinning' : ''}`} style={{
                        background: getWheelGradient(),
                        transform: !isSpinning && resultSlot ? `rotate(${wheelRotation}deg)` : 'rotate(0deg)'
                    }}>
                        {SLOTS.map((slot, i) => (
                            <div key={i} className="wheel-number" style={{
                                transform: `rotate(${i * anglePerSlot + (anglePerSlot / 2)}deg) translateY(-120px)`
                            }}>
                                {slot}
                            </div>
                        ))}
                    </div>
                    
                    <div className={`ball-container ${isSpinning ? 'spinning' : ''}`} style={{
                         transform: !isSpinning && resultSlot ? `rotate(${landingAngle}deg)` : 'rotate(0deg)'
                    }}>
                        <div className="ball"></div>
                    </div>

                    <div className="wheel-center">
                        {isSpinning ? (
                                <div style={{fontSize:10, color:'#FACC15', fontWeight:800}}>SPINNING</div>
                        ) : (
                            <>
                                <div className="result-label-center">{zone}</div>
                                <div className="result-number-center">{resultSlot || "?"}</div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        function App() {
            const [user, setUser] = useState(null);
            const [gameCode, setGameCode] = useState("");
            const [gameData, setGameData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [zone, setZone] = useState("PAR 4 TEE");
            const [currentSlot, setCurrentSlot] = useState(null);
            const [betSlot, setBetSlot] = useState(null); 
            const [isSpinning, setIsSpinning] = useState(false);
            const [modal, setModal] = useState({ open: false, title: "", message: "" });
            const [showSettings, setShowSettings] = useState(false);
            const [soundOn, setSoundOn] = useState(true);
            const spinSound = useRef(new Audio("https://cdn.freesound.org/previews/256/256113_3263906-lq.mp3"));

            useEffect(() => {
                const unsub = window.ops.onAuthStateChanged(window.auth, (u) => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsub();
            }, []);

            useEffect(() => {
                if (!gameCode) return;
                let interval;
                const unsub = window.ops.onSnapshot(window.ops.doc(window.db, "games", gameCode), (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        setGameData(data);
                        if (data.isSpinning) {
                            setIsSpinning(true);
                            if(!interval && soundOn) {
                                interval = setInterval(() => {
                                    spinSound.current.currentTime = 0;
                                    spinSound.current.volume = 0.1;
                                    spinSound.current.play().catch(e=>{});
                                }, 100);
                            }
                        } else {
                            setIsSpinning(false);
                            if(interval) clearInterval(interval);
                            if(data.lastNumber) setCurrentSlot(data.lastNumber);
                        }
                    }
                });
                return () => { unsub(); if(interval) clearInterval(interval); };
            }, [gameCode, soundOn]);

            useEffect(() => { if(window.lucide) window.lucide.createIcons(); });

            const handleLogout = async () => { setShowSettings(false); await window.ops.signOut(window.auth); setGameCode(""); setGameData(null); };
            const handleLogin = async () => { await window.ops.signInAnonymously(window.auth); };
            
            const createGame = async () => {
                const code = Math.random().toString(36).substring(2, 6).toUpperCase();
                await window.ops.setDoc(window.ops.doc(window.db, "games", code), {
                    host: user.uid, lastNumber: null, isSpinning: false, zone: "PAR 4 TEE", createdAt: new Date()
                });
                setGameCode(code);
            };
            
            const joinGame = async (codeInput) => {
                const code = codeInput.toUpperCase();
                if(code.length !== 4) return;
                const ref = window.ops.doc(window.db, "games", code);
                const snap = await window.ops.getDoc(ref);
                if (snap.exists()) setGameCode(code);
                else setModal({ open: true, title: "Error", message: "Room not found." });
            };
            
            const handleSpin = async () => {
                if(isSpinning) return;
                const ref = window.ops.doc(window.db, "games", gameCode);
                await window.ops.updateDoc(ref, { isSpinning: true, zone: zone, lastNumber: null });
                setTimeout(async () => {
                    const randomIdx = Math.floor(Math.random() * SLOTS.length);
                    const result = SLOTS[randomIdx];
                    await window.ops.updateDoc(ref, { isSpinning: false, lastNumber: result });
                }, 3500); 
            };

            const Header = () => (
                <div className="header">
                    {gameCode && (
                        <div className="room-info-container">
                            <div className="room-label">ROOM CODE</div>
                            <div className="room-code">{gameCode}</div>
                        </div>
                    )}
                    <img src="./images/logo512.png" className="header-logo" />
                    <div className="header-right">
                        <button className="header-btn" onClick={() => setShowSettings(true)}>
                            <i data-lucide="settings" size="24"></i>
                        </button>
                    </div>
                </div>
            );

            if (loading) return <div className="app-container" style={{justifyContent:'center', alignItems:'center'}}>Loading...</div>;

            // --- 1. START PAGE ---
            if (!user) return (
                <div className="app-container">
                    <div className="game-content">
                        <div className="top-section" style={{flexDirection:'column'}}>
                            <img src="./images/logo512.png" style={{width:220, height:220, marginBottom:30}} />
                            <h1 style={{fontFamily:'var(--font-display)', fontSize:48, lineHeight:1, marginBottom:10, color:'var(--primary)', textAlign:'center'}}>CADDIE<br/>ROULETTE</h1>
                        </div>
                        <div className="bottom-section">
                             <h3 style={{fontSize:16, fontWeight:700, color:'#374151', textTransform:'uppercase', letterSpacing:1, marginBottom:10}}>Your 15th Club</h3>
                            <p style={{marginBottom:40, color:'#6B7280', fontSize:14, lineHeight:1.6, textAlign:'center', maxWidth:300}}>
                                Spin for random challenges on the tee, fairway, and green. It won't help your score, but it will change the game.
                            </p>
                            <button className="btn btn-primary" onClick={handleLogin}>START ROUND</button>
                        </div>
                    </div>
                </div>
            );

            // --- 2. JOIN PAGE ---
            if (!gameCode) return (
                <div className="app-container">
                    <Modal isOpen={modal.open} title={modal.title} message={modal.message} onClose={() => setModal({...modal, open: false})} />
                    <SettingsModal isOpen={showSettings} onClose={() => setShowSettings(false)} soundOn={soundOn} toggleSound={() => setSoundOn(!soundOn)} onLogout={handleLogout} />
                    
                    <Header />
                    <div className="game-content">
                        <div className="top-section" style={{flexDirection:'column'}}>
                            <h2 style={{fontFamily:'var(--font-display)', fontSize:32, color:'#374151', marginBottom:30}}>NEW ROUND?</h2>
                            <button className="btn btn-primary" onClick={createGame} style={{width:'80%', maxWidth:'300px'}}>CREATE ROOM</button>
                        </div>
                        <div className="bottom-section">
                            <p style={{fontSize:12, fontWeight:800, color:'#9CA3AF', marginBottom:20, letterSpacing:1}}>OR JOIN FRIEND</p>
                            <input id="codeInput" className="input-lg" placeholder="ENTER CODE" maxLength="4" />
                            <button className="btn btn-accent" onClick={() => joinGame(document.getElementById('codeInput').value)}>
                                JOIN ROOM
                            </button>
                        </div>
                    </div>
                </div>
            );

            // --- 3. GAME PAGE ---
            const displayZone = gameData?.zone && CHALLENGES[gameData.zone] ? gameData.zone : "PAR 4 TEE";
            
            return (
                <div className="app-container">
                    <SettingsModal isOpen={showSettings} onClose={() => setShowSettings(false)} soundOn={soundOn} toggleSound={() => setSoundOn(!soundOn)} onLogout={handleLogout} />
                    
                    <Header />
                    <div className="game-content">
                        <div className="top-section">
                             <RouletteWheel isSpinning={isSpinning} resultSlot={currentSlot} zone={displayZone} />
                        </div>
                        
                        <div className="bottom-section">
                            {!isSpinning && currentSlot ? (
                                <div className="result-container">
                                    <div className="result-card">
                                        <div className="result-zone-badge">{displayZone}</div>
                                        <div className="result-number-pill" style={{background: getSlotColor(currentSlot)}}>#{currentSlot}</div>
                                        
                                        {betSlot === currentSlot ? (
                                            <>
                                                <div className="result-text" style={{color: 'var(--primary-light)', fontSize: '32px'}}>ðŸŽ‰ BET WON! ðŸŽ‰</div>
                                                <div style={{fontSize: '18px', fontWeight: 800, color: '#4B5563', textAlign: 'center', marginTop: '12px', textTransform: 'uppercase'}}>CHALLENGE SKIPPED!</div>
                                            </>
                                        ) : (
                                            <div className="result-text">{CHALLENGES[displayZone][currentSlot]}</div>
                                        )}

                                    </div>
                                    <button className="btn btn-primary" onClick={() => { setCurrentSlot(null); setBetSlot(null); }}>READY FOR NEXT SHOT</button>
                                </div>
                            ) : (
                                <>
                                    {/* AUTHENTIC ROULETTE BETTING BOARD */}
                                    <div className="betting-board-container">
                                        <div className="betting-board-label">PLACE BET TO SKIP CHALLENGE</div>
                                        <div className="betting-board">
                                            
                                            <div className="board-col-zeroes">
                                                {['0', '00'].map(z => (
                                                    <button key={z} className={`board-btn ${betSlot===z?'selected':''}`} style={{background: getSlotColor(z)}} onClick={() => !isSpinning && setBetSlot(betSlot===z ? null : z)}>
                                                        {z} {betSlot===z && <div className="golf-ball-chip"></div>}
                                                    </button>
                                                ))}
                                            </div>

                                            <div className="board-grid-main">
                                                <div className="board-row">
                                                    {[3,6,9,12,15,18,21,24,27,30,33,36].map(n => {
                                                        const s = String(n);
                                                        return <button key={s} className={`board-btn ${betSlot===s?'selected':''}`} style={{background: getSlotColor(s)}} onClick={() => !isSpinning && setBetSlot(betSlot===s ? null : s)}>{s} {betSlot===s && <div className="golf-ball-chip"></div>}</button>
                                                    })}
                                                </div>
                                                <div className="board-row">
                                                    {[2,5,8,11,14,17,20,23,26,29,32,35].map(n => {
                                                        const s = String(n);
                                                        return <button key={s} className={`board-btn ${betSlot===s?'selected':''}`} style={{background: getSlotColor(s)}} onClick={() => !isSpinning && setBetSlot(betSlot===s ? null : s)}>{s} {betSlot===s && <div className="golf-ball-chip"></div>}</button>
                                                    })}
                                                </div>
                                                <div className="board-row">
                                                    {[1,4,7,10,13,16,19,22,25,28,31,34].map(n => {
                                                        const s = String(n);
                                                        return <button key={s} className={`board-btn ${betSlot===s?'selected':''}`} style={{background: getSlotColor(s)}} onClick={() => !isSpinning && setBetSlot(betSlot===s ? null : s)}>{s} {betSlot===s && <div className="golf-ball-chip"></div>}</button>
                                                    })}
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    {/* HOST CONTROLS OR WAITING MESSAGE */}
                                    {gameData && gameData.host === user.uid ? (
                                        <>
                                            <div className="zone-selector">
                                                {Object.keys(CHALLENGES).map(z => (
                                                    <button key={z} className={`zone-btn ${zone === z ? 'active' : ''}`} onClick={() => setZone(z)}>{z}</button>
                                                ))}
                                            </div>
                                            <button className="btn btn-accent" onClick={handleSpin} disabled={isSpinning} style={{opacity: isSpinning ? 0.6 : 1}}>
                                                {isSpinning ? 'SPINNING...' : 'SPIN THE WHEEL'}
                                            </button>
                                        </>
                                    ) : (
                                        <div style={{textAlign:'center', color:'#9CA3AF', fontWeight:800, letterSpacing:1}}>
                                            {isSpinning ? 'HOST IS SPINNING...' : 'WAITING FOR HOST'}
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>